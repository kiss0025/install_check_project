<!DOCTYPE html>
<html lang="ko">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <script src="https://www.gstatic.com/firebasejs/7.2/firebase.js"></script>
        <!-- Firebase SDK -->
        <script src="https://www.gstatic.com/firebasejs/7.2/firebase-app.js"></script> 
        <script src="https://www.gstatic.com/firebasejs/7.2/firebase.js"></script>
        <!-- Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.bundle.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
        <style>
            html,
            body {
            width: 100%;
            height: 50px;
            padding: 0;
            margin: 0;
            background-color: black;
            }
            .overflow{
            width: 0;
            height: 0;
            margin: 0;
            overflow: hidden;
            }
            .volt-chart{
            width: 100%;
            height: 100%;
            margin: 0;
            overflow: visible;
            }
            #btn{
            border: 1px solid blue;
            background-color: rgba(0,0,0,0);
            color: blue;
            padding: 5px;
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
            margin-right:-4px;
            height:28px;
            font-size: 14px;
            }
            table {                
            border-collapse: collapse;
            width:500px;
            margin-left: auto;
            margin-right: auto;
            }
            table, td, th {
            border: solid 1px #cccccc;
            }
            tr {
            height:40px;
            text-align: center;
            }
            td, th {
            padding: 5px;
            }
            .set1 {
            background-color: red;
            color: white;
            text-decoration: underline;
            font-weight: bold;
            }
            #c_head {
            height:30px;
            background-color: #eeeeee;
            }
            #c_width{
            width: 500px;
            }
            @media only screen and (max-width: 500px) {
                .main-text {
                    font-size: 30px;
                }
                .sub-text {
                    font-size: 28px;
                }
                .sub-text span {
                    font-size: 30px;
                }
                button {
                    padding: 13px 28px;
                    width: 130px;
                    text-align: center;
                    font-size: 15px;
                    border-radius: 20px;
                    text-decoration: none;
                    border: none;
                    cursor: pointer;
                    outline: none;
                    color: white;
                    transition: background-color 200ms linear;
                }
            }
        </style>

    </head>
    <body>
        
        <div class="overflow" style="text-align: right;">
            <span id="object1" class="tempData" style="color:black; font-size: 15px;">fetching....</span>
            </span>           
        </div>
        <div style="text-align: center;">
            <span id="object2" class="voltData" style="color:red; font-size: 36px;">fetching....</span>
        </div>
        <div class="volt-chart" style="text-align: right;">
            <canvas id="line1"></canvas>
        </div>
        
        <script>
            n=0;
            // Initialize Firebase 
            var firebaseConfig = {
                apiKey: "Qt6iDXBO4vjbQIBCVcYgxdIzCQEF75ztyhL9JJAk",
                authDomain: "ss-project-1st.firebaseapp.com",
                databaseURL: "https://ss-project-1st-default-rtdb.firebaseio.com",
                projectId: "ss-project-1st",
                storageBucket: "ss-project-1st.appspot.com",
                messagingSenderId: "972254485944",
                appId: "1:972254485944:web:be2678a69cd7cbaf7f834d"
                };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            // firebase에서 읽기
            var demo = document.getElementById("demo");            
            var preObject1 = document.getElementById("object1"); //온습도
            var preObject2 = document.getElementById("object2"); //전압
            var dbRef = firebase.database().ref().child("esp8266");
            // Initialize arrays to hold data
            const timestamps = [];
            const voltageValues = [];
            // Retrieve data from Firebase and create a graph
            dbRef.on('value', snap => {
                const data = snap.val(); // Get the data object from Firebase
                
                // Extract individual values
                const temperature = data.temperature.toFixed(1); // Display temperature with one decimal place
                const humidity = data.humidity.toFixed(0); // Display humidity with one decimal place
                const voltage = data.voltage.toFixed(2); // Display voltage with one decimal place
                
                // Create formatted strings for display
                const formattedTemperature = `온도: ${temperature}°C`;
                const formattedHumidity = `습도: ${humidity}%`;
                const formattedVoltage = `Voltage: ${voltage} V`;
                
                // Combine all formatted data into a single string with line breaks
                //const formattedData = `${formattedTemperature}\n${formattedHumidity}\n${formattedVoltage}`;
                const formattedData1 = `${formattedTemperature} ${formattedHumidity}`;
                const formattedData2 = `${formattedVoltage}`;
                
                // Replace newline characters with <br> tags for HTML rendering
                const formattedHTML1 = formattedData1.replace(/\n/g, '<br>');
                const formattedHTML2 = formattedData2.replace(/\n/g, '<br>');
                
                preObject1.innerHTML = formattedHTML1; // Use innerHTML to render <br> tags
                preObject2.innerHTML = formattedHTML2; // Use innerHTML to render <br> tags
                console.log("측정", n++);

                chart.data.datasets[0].data.shift();
                chart.data.datasets[0].data.push(voltage);
                chart.update();
                
                console.log("==========", voltage);
            });
        </script>
        
        <!-- 그래프 그리는 부분 -->
        <script>  
            var ctx = document.getElementById('line1').getContext('2d');
            var chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['N-14' ,'N-13', 'N-12', 'N-11', 'N-10', 'N-9', 'N-8', 'N-7', 'N-6', 'N-5', 'N-4', 'N-3', 'N-2', 'N-1', 'N'],
                    datasets: [
                    {
                    label: 'Voltage',
                    backgroundColor: 'transparent',
                    borderColor: 'orange',
                    data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                  } ]
                },
                options: {
                    scales: {
                        y: {
                            min: 1,  // Set the minimum value for the y-axis
                            max: 20, // Set the maximum value for the y-axis
                            ticks: {
                                stepSize: 5 // Set the interval between tick marks
                            },
                            suggestedMin: 0, // Set the minimum value for the y-axis
                            suggestedMax: 20 // Set the maximum value for the y-axis
                        }
                    }
                    }
                });
        </script>

    </body>
</html>